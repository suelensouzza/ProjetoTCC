<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  rel="stylesheet"
/>

<header class="cabecalho bg-dark text-white py-3">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="logo">
      <h1 class="mb-0">ControlDesk</h1>
      <small class="text-muted">Sistema de Monitoramento de Computadores</small>
    </div>
    <div class="usuario-info d-flex align-items-center">
      <span class="nome-usuario me-2">Admin</span>
      <div class="avatar-usuario rounded-circle bg-primary d-flex justify-content-center align-items-center" style="width:35px; height:35px; font-weight:bold;">
        A
      </div>
    </div>
  </div>
</header>

<div class="computer-body container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <h2 class="mb-1">游눹 Gerenciar Computadores</h2>
        <p class="text-muted mb-0">Gerencie todos os computadores do sistema</p>
      </div>
      <div>
        <button class="btn btn-secondary me-2" (click)="voltarHome()">
          <i class="fas fa-arrow-left"></i> Voltar
        </button>
        <button class="btn btn-primary" (click)="abrirModal()">
          <i class="fas fa-plus"></i> Adicionar Computador
        </button>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-3 mb-2">
      <div class="card bg-primary text-white text-center">
        <div class="card-body">
          <h4 class="mb-0">{{ total }}</h4>
          <p class="mb-0">Total</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-2">
      <div class="card bg-success text-white text-center">
        <div class="card-body">
          <h4 class="mb-0">{{ excellent }}</h4>
          <p class="mb-0">Excelente</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-2">
      <div class="card bg-warning text-white text-center">
        <div class="card-body">
          <h4 class="mb-0">{{ maintenance }}</h4>
          <p class="mb-0">Manuten칞칚o</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-2">
      <div class="card bg-danger text-white text-center">
        <div class="card-body">
          <h4 class="mb-0">{{ critical }}</h4>
          <p class="mb-0">Cr칤tico</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4 mb-2">
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input
          type="text"
          class="form-control"
          placeholder="Buscar computador..."
          [(ngModel)]="searchTerm"
        />
      </div>
    </div>
    <div class="col-md-3 mb-2">
      <select class="form-select" [(ngModel)]="selectedStatus">
        <option value="">Todos os Status</option>
        <option value="EXCELENTE">Excelente</option>
        <option value="BOM">Bom</option>
        <option value="REGULAR">Regular</option>
        <option value="CRITICO">Cr칤tico</option>
      </select>
    </div>
    <div class="col-md-3 mb-2">
      <select class="form-select" [(ngModel)]="selectedLocation">
        <option value="">Todas as Localiza칞칫es</option>
        <option value="Sala 101">Sala 101</option>
        <option value="Sala 102">Sala 102</option>
        <option value="Sala 103">Sala 103</option>
        <option value="Laborat칩rio A">Laborat칩rio A</option>
      </select>
    </div>
  </div>

  <div class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Localiza칞칚o</th>
              <th>Status</th>
              <th>Modelo</th>
              <th>Mem칩ria Permanente</th>
              <th>Mem칩ria Vol치til</th>
              <th>칔ltima Manuten칞칚o</th>
              <th>Pr칩xima Manuten칞칚o</th>
              <th>A칞칫es</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of filteredComputers">
              <td><span class="badge bg-secondary">{{ encurtarId(c.id) }}</span></td>
              <td>{{ c.nome }}</td>
              <td>{{ c.localizacao }}</td>
              <td>
                <span class="badge"
                  [ngClass]="{
                    'badge-excelente': c.status === 'EXCELENTE',
                    'badge-bom': c.status === 'BOM',
                    'badge-regular': c.status === 'REGULAR',
                    'badge-critico': c.status === 'CRITICO'
                  }"
                >
                  <span class="status-indicator"
                    [ngStyle]="{
                      'background-color': 
                        c.status === 'EXCELENTE' ? '#28a745' :
                        c.status === 'BOM' ? '#17a2b8' :
                        c.status === 'REGULAR' ? '#ffc107' :
                        c.status === 'CRITICO' ? '#dc3545' : '#6c757d'
                    }"
                    style="display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:5px;"
                  ></span>
                  {{ c.status }}
                </span>
              </td>
              <td>{{ c.modelo }}</td>
              <td>{{ c.memoriaPermanente }}</td>
              <td>{{ c.memoriaVolatil }}</td>
              <td>{{ c.ultimaManutencao }}</td>
              <td>{{ c.proximaManutencao }}</td>
              <td>
                <div class="btn-group" role="group" aria-label="A칞칫es computador">
                  <button class="btn btn-info btn-sm" (click)="visualizarComputador(c.id)" title="Visualizar">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-warning btn-sm" (click)="editarComputador(c)" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" (click)="excluirComputador(c.id)" title="Excluir">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredComputers.length === 0">
              <td colspan="10" class="text-center text-muted">Nenhum computador encontrado.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<!-- Modal Detalhes Computador -->
<div
  class="modal"
  tabindex="-1"
  role="dialog"
  [ngClass]="{'show d-block': computadorSelecionado !== null}"
  [style.background]="'rgba(0,0,0,0.5)'"
  [attr.aria-modal]="computadorSelecionado !== null ? 'true' : null"
  [attr.aria-hidden]="computadorSelecionado === null ? 'true' : null"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalhes do Computador</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="fecharDetalhes()"></button>
      </div>
      <div class="modal-body" *ngIf="computadorSelecionado">
        <p><strong>Nome:</strong> {{ computadorSelecionado.nome }}</p>
        <p><strong>Localiza칞칚o:</strong> {{ computadorSelecionado.localizacao }}</p>
        <p><strong>Modelo:</strong> {{ computadorSelecionado.modelo }}</p>
        <p><strong>Status:</strong> {{ computadorSelecionado.status }}</p>
        <p><strong>Mem칩ria Permanente:</strong> {{ computadorSelecionado.memoriaPermanente }}</p>
        <p><strong>Mem칩ria Vol치til:</strong> {{ computadorSelecionado.memoriaVolatil }}</p>
        <p><strong>칔ltima Manuten칞칚o:</strong> {{ computadorSelecionado.ultimaManutencao }}</p>
        <p><strong>Pr칩xima Manuten칞칚o:</strong> {{ computadorSelecionado.proximaManutencao }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="fecharDetalhes()">Fechar</button>
      </div>
    </div>
  </div>
</div>


  <!-- Modal -->
  <div class="modal d-block" *ngIf="modalAberto" tabindex="-1" role="dialog" style="background: rgba(0,0,0,0.5);">
    <div class="modal-dialog" role="document">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title">{{ modoEdicao ? 'Editar Computador' : 'Adicionar Computador' }}</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="fecharModal()"></button>
        </div>
        <div class="modal-body">
          <form (submit)="salvarComputador(); $event.preventDefault()">
            <div class="mb-3">
              <label class="form-label">Nome *</label>
              <input type="text" class="form-control" [(ngModel)]="novoComputador.nome" name="nome" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Localiza칞칚o *</label>
              <input type="text" class="form-control" [(ngModel)]="novoComputador.localizacao" name="localizacao" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Modelo *</label>
              <input type="text" class="form-control" [(ngModel)]="novoComputador.modelo" name="modelo" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Mem칩ria Permanente *</label>
              <input type="text" class="form-control" [(ngModel)]="novoComputador.memoriaPermanente" name="memoriaPermanente" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Mem칩ria Vol치til *</label>
              <input type="text" class="form-control" [(ngModel)]="novoComputador.memoriaVolatil" name="memoriaVolatil" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Status *</label>
              <select class="form-select" [(ngModel)]="novoComputador.status" name="status" required>
                <option value="EXCELENTE">Excelente</option>
                <option value="BOM">Bom</option>
                <option value="REGULAR">Regular</option>
                <option value="CRITICO">Cr칤tico</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">칔ltima Manuten칞칚o</label>
              <input type="date" class="form-control" [(ngModel)]="novoComputador.ultimaManutencao" name="ultimaManutencao" />
            </div>
            <div class="mb-3">
              <label class="form-label">Pr칩xima Manuten칞칚o</label>
              <input type="date" class="form-control" [(ngModel)]="novoComputador.proximaManutencao" name="proximaManutencao" />
            </div>
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
              <button type="submit" class="btn btn-success">{{ modoEdicao ? 'Salvar' : 'Adicionar' }}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
